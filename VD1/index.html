<!DOCTYPE html>
<html lang="en">
    <head>
        <title>VD1</title>
        <style>
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 2em;
                letter-spacing: -0.011em;
                font-family: sans-serif;
                font-size: 16px;
                color: #34495e;
                background: #f8f9fa;
            }

            #wrapper {
                background: #34495e;
                border-radius: 5px;
            }

            #wrapper2 {
                background: #34495e;
                border-radius: 5px;
                margin-top: 20px;
            }
            
            svg {
                fill: #fff;
                display: block;
            }

            .description {
                width: 800px;
            }
        </style>
    </head>
    <body>
        <div id="wrapper"></div>
        <p class="description">In this visualization I used the diverging bar chart idea.</p>
        <div id="wrapper2"></div>
        <p class="description">Hi</p>
        <script src="//d3js.org/d3.v6.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/ramda/0.25.0/ramda.min.js"></script>
        <script>
            function prepDataAvgIncomeByAgeAndGender(data) {
                console.log(data)
                const genderBasedIncomeAvg = {}
                for (const property in data) {
                    const maleData = R.filter(R.propEq('sex', 'Male'), data[property]);
                    const femaleData = R.filter(R.propEq('sex', 'Female'), data[property]);
                    
                    const incomeOccurrences = R.compose(R.length, R.filter(R.pathEq(['income'], '<=50K')))
                    const maleAvg = incomeOccurrences(maleData) / maleData.length > .5 ? "<=50K" : ">50k";
                    const femaleAvg = incomeOccurrences(femaleData) / femaleData.length > .5 ? "<=50K" : ">50k";

                    genderBasedIncomeAvg[property] = {maleAvg, femaleAvg, age: property};
                }
                return genderBasedIncomeAvg;
            }

            async function drawBars() {
                // 1. Access data & pre-process data
                const rawDataset = await d3.csv("income_evaluation.csv");
                const columns = rawDataset.columns;
                const groupDataByKeys = R.mergeAll(columns.map(c => ({[c]: R.groupBy(R.prop(c), rawDataset)})))

                const data = prepDataAvgIncomeByAgeAndGender(groupDataByKeys.age);
                const keys = R.keys(data);
                const numberOfKeys = keys.length;

                // 2. Create chart dimensions

                const width = 800;
                let dimensions = {
                    width: width,
                    height: width * 0.5,
                    margin: {
                    top: 30,
                    right: 10,
                    bottom: 0,
                    left: 50,
                    },
                };
                dimensions.boundedWidth =
                    dimensions.width - dimensions.margin.left - dimensions.margin.right;
                dimensions.boundedHeight =
                    dimensions.height - dimensions.margin.top - dimensions.margin.bottom;

                // // 3. Draw canvas

                const wrapper = d3
                    .select("#wrapper")
                    .append("svg")
                    .attr("width", dimensions.width)
                    .attr("height", dimensions.height);

                const bounds = wrapper
                    .append("g")
                    .style(
                    "transform",
                    `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
                    );

                // 4. Create scales

                const xScale = d3
                    .scaleLinear()
                    .domain(d3.extent(keys))
                    .range([30, dimensions.boundedWidth - 70]);

                // // 5. Draw data

                const colors = {male: "#95e1d3", female: "#f38181"};

                wrapper.append("g")
                    .selectAll("rect")
                    .data(R.values(data))
                    .join("rect")
                    .attr("x", (d, i) => xScale(d.age) + dimensions.margin.left)
                    .attr("y", d => (d.maleAvg === "<=50K" ? dimensions.boundedHeight / 2  - 50: dimensions.boundedHeight / 2 + 22) + dimensions.margin.top - 1)
                    .attr("fill", colors.male)
                    .attr("height", 50)
                    .attr("width", 4);

                wrapper.append("g")
                    .selectAll("rect")
                    .data(R.values(data))
                    .join("rect")
                    .attr("x", (d, i) => xScale(d.age) + dimensions.margin.left)
                    .attr("y", d => (d.femaleAvg === "<=50K" ? dimensions.boundedHeight / 2  - 100: dimensions.boundedHeight / 2 + 72) + dimensions.margin.top - 1)
                    .attr("fill", colors.female)
                    .attr("height", 50)
                    .attr("width", 4);

                // // 6. Draw peripherals

                const xAxisGenerator = d3.axisBottom().scale(xScale).ticks(numberOfKeys / 2).tickSize(0);

                const xAxis = bounds
                    .append("g")
                    .call(xAxisGenerator)
                    .style("transform", `translateY(${dimensions.boundedHeight / 2}px)`)
                    .attr("stroke-width", "0")
                    .call(selection => selection
                            .selectAll('text')
                            .attr('fill', '#fff')
                            .attr('dy', '11'));

                bounds.append("g").append('line')
                    .style("stroke", "#eaeaea")
                    .style("stroke-width", 1)
                    .attr("x1", 25)
                    .attr("y1", dimensions.boundedHeight / 2 + 20)
                    .attr("x2", dimensions.boundedWidth - 60)
                    .attr("y2", dimensions.boundedHeight / 2 + 20); 

                bounds.append("g").append('line')
                    .style("stroke", "#eaeaea")
                    .style("stroke-width", 1)
                    .attr("x1", 25)
                    .attr("y1", dimensions.boundedHeight / 2)
                    .attr("x2", dimensions.boundedWidth - 60)
                    .attr("y2", dimensions.boundedHeight / 2); 

                // Add X axis label:
                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", dimensions.boundedWidth - 10)
                    .attr("y", dimensions.boundedHeight / 2 + 15)
                    .text("Age");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", 5)
                    .attr("y", dimensions.boundedHeight / 2 - 70)
                    .text("<=50K");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", 5)
                    .attr("y", dimensions.boundedHeight / 2 + 100)
                    .text(">50k");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("transform", `translate(-15, ${dimensions.boundedHeight / 2 + 10})  rotate(-90)`)
                    .attr("text-anchor", "middle")
                    .text("Income")
                    ;

                wrapper.append("circle").attr("cx",dimensions.boundedWidth - 10).attr("cy",50).attr("r", 6).style("fill", colors.male)
                wrapper.append("circle").attr("cx",dimensions.boundedWidth - 10).attr("cy",70).attr("r", 6).style("fill", colors.female)
                wrapper.append("text").attr("x", dimensions.boundedWidth).attr("y", 50).text("Male").style("font-size", "15px").attr("alignment-baseline","middle")
                wrapper.append("text").attr("x", dimensions.boundedWidth).attr("y", 70).text("Female").style("font-size", "15px").attr("alignment-baseline","middle")

            }
            drawBars();

            async function drawBars2() {
                // 1. Access data & pre-process data
                const rawDataset = await d3.csv("income_evaluation.csv");
                const columns = rawDataset.columns;
                const groupDataByKeys = R.mergeAll(columns.map(c => ({[c]: R.groupBy(R.prop(c), rawDataset)})))

                const data = prepDataAvgIncomeByAgeAndGender(groupDataByKeys.age);
                const keys = R.keys(data);
                const numberOfKeys = keys.length;

                // 2. Create chart dimensions

                const width = 800;
                let dimensions = {
                    width: width,
                    height: width * 0.5,
                    margin: {
                    top: 30,
                    right: 10,
                    bottom: 0,
                    left: 50,
                    },
                };
                dimensions.boundedWidth =
                    dimensions.width - dimensions.margin.left - dimensions.margin.right;
                dimensions.boundedHeight =
                    dimensions.height - dimensions.margin.top - dimensions.margin.bottom;

                // // 3. Draw canvas

                const wrapper = d3
                    .select("#wrapper2")
                    .append("svg")
                    .attr("width", dimensions.width)
                    .attr("height", dimensions.height);

                const bounds = wrapper
                    .append("g")
                    .style(
                    "transform",
                    `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
                    );

                // 4. Create scales

                const xScale = d3
                    .scaleLinear()
                    .domain(d3.extent(keys))
                    .range([30, dimensions.boundedWidth - 70]);

                // // 5. Draw data

                const colors = {male: "#95e1d3", female: "#f38181"};

                wrapper.append("g")
                    .selectAll("rect")
                    .data(R.values(data))
                    .join("rect")
                    .attr("x", (d, i) => xScale(d.age) + dimensions.margin.left)
                    .attr("y", d => (d.maleAvg === "<=50K" ? dimensions.boundedHeight / 2  - 50: dimensions.boundedHeight / 2 + 22) + dimensions.margin.top - 1)
                    .attr("fill", colors.male)
                    .attr("height", 50)
                    .attr("width", 4);

                wrapper.append("g")
                    .selectAll("rect")
                    .data(R.values(data))
                    .join("rect")
                    .attr("x", (d, i) => xScale(d.age) + dimensions.margin.left)
                    .attr("y", d => (d.femaleAvg === "<=50K" ? dimensions.boundedHeight / 2  - 100: dimensions.boundedHeight / 2 + 72) + dimensions.margin.top - 1)
                    .attr("fill", colors.female)
                    .attr("height", 50)
                    .attr("width", 4);

                // // 6. Draw peripherals

                const xAxisGenerator = d3.axisBottom().scale(xScale).ticks(numberOfKeys / 2).tickSize(0);

                const xAxis = bounds
                    .append("g")
                    .call(xAxisGenerator)
                    .style("transform", `translateY(${dimensions.boundedHeight / 2}px)`)
                    .attr("stroke-width", "0")
                    .call(selection => selection
                            .selectAll('text')
                            .attr('fill', '#fff')
                            .attr('dy', '11'));

                bounds.append("g").append('line')
                    .style("stroke", "#eaeaea")
                    .style("stroke-width", 1)
                    .attr("x1", 25)
                    .attr("y1", dimensions.boundedHeight / 2 + 20)
                    .attr("x2", dimensions.boundedWidth - 60)
                    .attr("y2", dimensions.boundedHeight / 2 + 20); 

                bounds.append("g").append('line')
                    .style("stroke", "#eaeaea")
                    .style("stroke-width", 1)
                    .attr("x1", 25)
                    .attr("y1", dimensions.boundedHeight / 2)
                    .attr("x2", dimensions.boundedWidth - 60)
                    .attr("y2", dimensions.boundedHeight / 2); 

                // Add X axis label:
                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", dimensions.boundedWidth)
                    .attr("y", dimensions.boundedHeight / 2 + 15)
                    .text("Age");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", 5)
                    .attr("y", dimensions.boundedHeight / 2 - 70)
                    .text("<=50K");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("x", 5)
                    .attr("y", dimensions.boundedHeight / 2 + 100)
                    .text(">50k");

                bounds.append("text")
                    .attr("text-anchor", "end")
                    .attr("transform", `translate(-15, ${dimensions.boundedHeight / 2 + 10})  rotate(-90)`)
                    .attr("text-anchor", "middle")
                    .text("Income")
                    ;

                wrapper.append("circle").attr("cx",dimensions.boundedWidth - 10).attr("cy",50).attr("r", 6).style("fill", colors.male)
                wrapper.append("circle").attr("cx",dimensions.boundedWidth - 10).attr("cy",70).attr("r", 6).style("fill", colors.female)
                wrapper.append("text").attr("x", dimensions.boundedWidth).attr("y", 50).text("Male").style("font-size", "15px").attr("alignment-baseline","middle")
                wrapper.append("text").attr("x", dimensions.boundedWidth).attr("y", 70).text("Female").style("font-size", "15px").attr("alignment-baseline","middle")

            }
            drawBars2();
        </script>
    </body>
</html>